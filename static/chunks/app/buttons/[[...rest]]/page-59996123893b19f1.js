(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8167],{18921:(e,t,n)=>{Promise.resolve().then(n.bind(n,43700))},29392:(e,t,n)=>{"use strict";n.d(t,{_1:()=>s,b4:()=>a,lQ:()=>r,ln:()=>i});var a=function(e){return e.Minutes5="minutes5",e.Minutes10="minutes10",e.Minutes20="minutes20",e.Minutes30="minutes30",e.Hourly="hourly",e.Daily="daily",e.Weekly="weekly",e}({}),i=function(e){return e.Manual="manual",e.Scheduled="scheduled",e}({}),s=function(e){return e.MarkAsRead="markAsRead",e.MarkAsUnread="markAsUnread",e.Star="star",e.Unstar="unstar",e.OpenLink="openLink",e}({}),r=function(e){return e.Edit="edit",e.Delete="delete",e.Enable="enable",e.Disable="disable",e.Fetch="fetch",e}({})},43700:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var a=n(54568),i=n(7620),s=n(62942),r=n(53979),o=n(66259),l=n(30538),u=n(20667),d=n(92211);let c=e=>{let{id:t,initialValues:n={},groupId:i,onSuccess:s}=e,{form:c,formProps:y}=(0,l.useForm)(),[p,{setFalse:g,setTrue:b}]=(0,l.useBoolean)(),{createState:m,updateState:h}=(0,u.Vp)({list:!1,create:{onSuccess:()=>{g(),null==s||s()}},update:{onSuccess:()=>{g(),null==s||s()}}}),x=async()=>{await c.validateFields();let e=c.getFieldsValue();if(t){h.mutate(t,e);return}m.mutate({groupId:i,sort:99,...e})};return(0,a.jsxs)(a.Fragment,{children:[t?(0,a.jsx)("span",{onClick:b,children:"修改"}):(0,a.jsx)(r.VL1,{rectWidth:50,rectHeight:32,sectors:[{id:d.ButtonsType.Copy},{id:d.ButtonsType.Command}],onClick:async e=>{if(i){if(e===d.ButtonsType.Command)b(),c.setFieldsValue({type:e});else{let e=await navigator.clipboard.readText();if(!e)return;m.mutate({groupId:i,sort:99,type:d.ButtonsType.Copy,content:e})}}}}),(0,a.jsx)(r.aFV,{title:t?"修改按钮":"新建按钮",open:p,onOk:x,onCancel:g,children:(0,a.jsx)(r.kyL,{form:c,submitter:!1,layout:"horizontal",labelCol:{span:4},initialValues:n,onValuesChange:y.onValuesChange,columns:[{title:"类型",dataIndex:"type",valueType:"radio",fieldProps:{optionType:"button",buttonStyle:"solid",options:o.xW},formItemProps:{rules:[{required:!0}]}},{title:"标题",dataIndex:"title"},{title:"内容",dataIndex:"content",valueType:"textarea",fieldProps:{rows:5},formItemProps:{rules:[{required:!0}]}}]})})]})},y=e=>{let{id:t,onSuccess:n}=e,{removeState:i}=(0,u.Vp)({list:!1,remove:{onSuccess:n}});return(0,a.jsx)(r.iS5,{title:"确定要删除吗？",okText:"确定",cancelText:"取消",onConfirm:()=>i.mutate(t),children:(0,a.jsx)("span",{children:"删除"})})};var p=n(45447),g=n(38993),b=n(50585);let m=e=>{let{item:t}=e,{isHovered:n,hoverProps:i}=(0,l.useHovered)(),s=g.F.useUtils(),{listState:o}=(0,u.Vp)({list:{query:{orderBy:{sort:"desc"},where:{groupId:null==t?void 0:t.i}},option:{enabled:!!(null==t?void 0:t.i)}}}),m=g.F.custom.buttonsItem.updateSort.useMutation({onSuccess:()=>null==o?void 0:o.refetch()}),h=e=>[{key:"edit",label:(0,a.jsx)(c,{id:e.id,initialValues:e,onSuccess:o.refetch})},{key:"delete",danger:!0,label:(0,a.jsx)(y,{id:e.id,onSuccess:o.refetch})}],x=e=>{(null==e?void 0:e.type)===d.ButtonsType.Copy&&((0,p.C)(e.content),b.Ay.success("复制成功"))};return(0,a.jsx)(r.tKH,{spinning:o.isLoading,children:(0,a.jsx)("div",{...i,className:"h-full",children:(0,a.jsx)(r.BbE,{list:o.data,direction:"horizontal",dropType:"button",onDragEnd:e=>{if(e.destination&&"button"===e.type){let n=Array.from(o.data||[]),[a]=n.splice(e.source.index,1);a&&n.splice(e.destination.index,0,a),s.buttonItem.findMany.setData({orderBy:{sort:"asc"},where:{groupId:null==t?void 0:t.i}},n),m.mutate(n.map((e,t)=>({id:e.id,sort:t})))}},lastChildren:(null==t?void 0:t.i)&&(0,a.jsx)("div",{className:"transition-opacity duration-300 ".concat(n?"opacity-100":"opacity-0"),children:(0,a.jsx)(c,{groupId:null==t?void 0:t.i,onSuccess:o.refetch})}),children:(e,t)=>(0,a.jsx)("div",{children:(0,a.jsx)(r.msM,{getPopupContainer:e=>e,trigger:["contextMenu"],menu:{items:h(e)},children:(0,a.jsx)("div",{...t.dragHandleProps,children:(0,a.jsx)(r.$nd,{onClick:()=>x(e),children:(null==e?void 0:e.title)||e.content})})})},e.id)})})})},h=e=>{let{item:t,onChangeName:n}=e,{isHovered:i,hoverProps:s}=(0,l.useHovered)();return(0,a.jsx)(r.ZpM,{...s,size:"small",style:{width:"100%",height:"100%"},bodyStyle:{height:"80%"},title:(0,a.jsx)(r.ksK,{value:t.data.title,onChange:e=>n(t.i,e)}),extra:i&&(0,a.jsx)(r.duJ,{className:"drag-handle cursor-grab"}),children:(0,a.jsx)(m,{item:t})})},x=e=>{let{params:t}=e,{rest:[n]=[]}=t,o=(0,s.useRouter)(),[u,d]=(0,i.useState)([]),c=(0,i.useMemo)(()=>u.map(e=>p._.pick(e,["i","w","h","x","y","data"])),[u]),y=g.F.commonGroupLayout.create.useMutation(),b=g.F.commonGroupLayout.update.useMutation(),m=g.F.commonGroupLayout.findUnique.useQuery({where:{id:n}},{enabled:!!n});(0,i.useEffect)(()=>{var e;if(!m.isLoading&&!u.length){if(!m.data){n&&o.push("/buttons");return}d((null===(e=m.data)||void 0===e?void 0:e.data)||[])}},[n,m,u.length,o]),(0,l.useAsyncEffect)(async()=>{var e,t;if(!m.isLoading){if(!n){let e=await y.mutateAsync({data:{data:c}});e&&o.push("/buttons/".concat(e.id));return}!p._.isEqual(c,null===(t=m.data)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.map(e=>p._.pick(e,["i","w","h","x","y","data"])))&&await b.mutateAsync({where:{id:n},data:{data:c}})}},[JSON.stringify(c)]);let x=(e,t)=>{d(u.map(n=>n.i!==e?n:{...n,data:{...n.data,title:t}}))};return(0,a.jsxs)("div",{className:"p-6 w-full h-[100vh] flex flex-col",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-3",children:"按钮大盘"}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(r.$nd,{type:"primary",onClick:()=>{d([...u,{i:Date.now().toString(),w:4,h:2,x:0,y:0,data:{title:"aaa"}}])},children:"添加分组"})}),(0,a.jsx)("div",{className:"flex-1 mt-2",children:(0,a.jsx)(r.UC8,{layout:u,onChange:d,renderItem:e=>(0,a.jsx)(h,{item:e,onChangeName:x})})})]})}},66259:(e,t,n)=>{"use strict";n.d(t,{GX:()=>s,dw:()=>r,Rx:()=>i,dF:()=>o,xW:()=>l});var a=n(92211);let i={[a.HabitProgressStatus.Disabled]:"已禁用",[a.HabitProgressStatus.Enabled]:"已启用",[a.HabitProgressStatus.Pending]:"待开始",[a.HabitProgressStatus.Doing]:"进行中",[a.HabitProgressStatus.Done]:"已完成",[a.HabitProgressStatus.Failed]:"已失败"},s={[a.HabitFrequencyType.DAILY]:"每日",[a.HabitFrequencyType.WEEKLY]:"每周",[a.HabitFrequencyType.MONTHLY]:"每月"},r={[a.HabitFrequencyType.DAILY]:"日",[a.HabitFrequencyType.WEEKLY]:"周",[a.HabitFrequencyType.MONTHLY]:"月"},o={[a.HabitProgressStatus.Enabled]:{bg:"bg-blue-500 hover:bg-blue-600",ring:""},[a.HabitProgressStatus.Disabled]:{bg:"bg-gray-400 hover:bg-gray-500",ring:""},[a.HabitProgressStatus.Pending]:{bg:"bg-gray-300 hover:bg-gray-400",ring:""},[a.HabitProgressStatus.Done]:{bg:"bg-green-500 hover:bg-green-600",ring:""},[a.HabitProgressStatus.Doing]:{bg:"bg-yellow-500 hover:bg-yellow-600",ring:"text-yellow-300"},[a.HabitProgressStatus.Failed]:{bg:"text-red-300 hover:bg-red-600",ring:"bg-red-500"}},l=[{label:"复制粘贴",value:a.ButtonsType.Copy},{label:"执行命令",value:a.ButtonsType.Command}]},92211:(e,t,n)=>{"use strict";n.d(t,{ButtonsType:()=>r,CollectingType:()=>o,HabitFrequencyType:()=>a,HabitProgressStatus:()=>i,HabitStatusMode:()=>s,RssFeedActionType:()=>l.lQ,RssFetchTriggerType:()=>l.ln,RssFrequency:()=>l.b4,RssItemActionType:()=>l._1});var a=function(e){return e.DAILY="DAILY",e.WEEKLY="WEEKLY",e.MONTHLY="MONTHLY",e}({}),i=function(e){return e.Disabled="disabled",e.Enabled="enabled",e.Pending="pending",e.Doing="doing",e.Done="done",e.Failed="failed",e}({}),s=function(e){return e.Habit="habit",e.Record="record",e}({});n(93657);var r=function(e){return e.Command="command",e.Copy="copy",e}({}),o=function(e){return e.Url="url",e.Prompt="prompt",e.Copy="copywriter",e}({}),l=n(29392)},93657:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[6854,6410,541,6771,2602,1598,1815,8259,1210,2998,6502,5888,4030,794,9223,4033,9565,2983,3651,1026,959,5229,5533,667,587,8315,7358],()=>t(18921)),_N_E=e.O()}]);