(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1083],{25381:(e,t,r)=>{"use strict";r.d(t,{D:()=>u});var l=r(54568),n=r(7620),a=r(53979);let s=e=>{if(e.length<=3)return e;let t=Math.min(3,Math.ceil(e.length/2));return e.substring(0,t)+"\n"+s(e.substring(t))};var i=r(66259),o=r(92211);let u=e=>{var t,r,u,d,c,p;let{data:b,mode:m}=e,y=(0,n.useRef)(null),g=null!==(d=null==b?void 0:null===(t=b.record)||void 0===t?void 0:t.progress)&&void 0!==d?d:0,f=null!==(p=null!==(c=null==b?void 0:null===(r=b.status)||void 0===r?void 0:r[m])&&void 0!==c?c:b.enabled?o.HabitProgressStatus.Enabled:o.HabitProgressStatus.Disabled)&&void 0!==p?p:o.HabitProgressStatus.Pending;(0,n.useEffect)(()=>{y.current=f},[f]);let v=f===o.HabitProgressStatus.Done&&y.current!==o.HabitProgressStatus.Done,h=null==b?void 0:b.frequency.type,x=i.dw[h];return(0,l.jsx)(a.Exy,{color:"#f50",count:h!==o.HabitFrequencyType.DAILY?x:"",offset:[-8,8],style:{zoom:.9},children:(0,l.jsx)(a.Wlx,{colors:i.dF[f],progress:null===(u=b.record)||void 0===u?void 0:u.progress,showRing:g>0&&g<1,className:v?"animate-complete":"",children:s(b.name)})})}},26768:(e,t,r)=>{"use strict";r.d(t,{y:()=>n});let l=e=>{let t;let r=new Set,l=(e,l)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=l?l:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,a={setState:l,getState:n,getInitialState:()=>s,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},s=t=e(l,n,a);return a},n=e=>e?l(e):l},29392:(e,t,r)=>{"use strict";r.d(t,{_1:()=>a,b4:()=>l,lQ:()=>s,ln:()=>n});var l=function(e){return e.Minutes5="minutes5",e.Minutes10="minutes10",e.Minutes20="minutes20",e.Minutes30="minutes30",e.Hourly="hourly",e.Daily="daily",e.Weekly="weekly",e}({}),n=function(e){return e.Manual="manual",e.Scheduled="scheduled",e}({}),a=function(e){return e.MarkAsRead="markAsRead",e.MarkAsUnread="markAsUnread",e.Star="star",e.Unstar="unstar",e.OpenLink="openLink",e}({}),s=function(e){return e.Edit="edit",e.Delete="delete",e.Enable="enable",e.Disable="disable",e.Fetch="fetch",e}({})},47777:e=>{e.exports={menu:"components_menu__J2i0V"}},48881:(e,t,r)=>{Promise.resolve().then(r.bind(r,58771))},58771:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>D});var l=r(54568),n=r(7620),a=r(53979),s=r(20667);let i=e=>{let{item:t,onSuccess:r}=e,{updateState:n}=(0,s.LX)({list:!1,update:{onSuccess:()=>{null==r||r()}}});return(0,l.jsx)(a.ksK,{value:t.name,onChange:e=>{n.mutate(t.id,{name:e})}})};var o=r(25381),u=r(30538),d=r(66259);let c=(0,n.forwardRef)((e,t)=>{let{value:r,type:s,onChange:i}=e,{form:o}=(0,u.useForm)({ref:t});(0,n.useEffect)(()=>{if(r){o.setFieldsValue(r);return}o.setFieldsValue({times:1,single:1,total:1,unit:"次"}),null==i||i({times:1,single:1,total:1,unit:"次"})},[o,i,r]);let c=d.dw[s];return(0,l.jsx)(a.kyL,{form:o,initialValues:r,submitter:!1,layout:"inline",onValuesChange:(e,t)=>{t.total&&t.single&&(t.times=t.total/t.single),null==i||i(t)},columns:[{dataIndex:"total",title:c?"每".concat(c,"执行总量"):"执行总量",valueType:"digit",formItemProps:{rules:[{required:!0}]},fieldProps:{step:1,precision:0,style:{width:100}}},{dataIndex:"single",title:"每次执行量",valueType:"digit",formItemProps:{rules:[{required:!0}]},fieldProps:{step:1,precision:0,style:{width:100},min:1}},{dataIndex:"times",title:"执行几次",valueType:"digit",formItemProps:{rules:[{required:!0}]},fieldProps:{step:1,precision:0,style:{width:100},min:1,disabled:!0}},{dataIndex:"unit",title:"单位",width:80,valueType:"select",fieldProps:{options:[{label:"次",value:"次"},{label:"毫升",value:"毫升"},{label:"克",value:"克"},{label:"斤",value:"斤"},{label:"小时",value:"小时"},{label:"分钟",value:"分钟"}]}}]})});var p=r(92211);let b=(0,n.forwardRef)((e,t)=>{let{value:r,onChange:n}=e,{form:s}=(0,u.useImperativeHandleForm)(t);return(0,l.jsx)(a.kyL,{form:s,initialValues:r,submitter:!1,onValuesChange:(e,t)=>null==n?void 0:n(t),columns:[{dataIndex:"type",title:"周期",valueType:"radio",formItemProps:{rules:[{required:!0}]},fieldProps:{optionType:"button",buttonStyle:"solid",options:[{label:"每天",value:p.HabitFrequencyType.DAILY},{label:"每周",value:p.HabitFrequencyType.WEEKLY},{label:"每月",value:p.HabitFrequencyType.MONTHLY}]}},{dataIndex:"weekDays",title:"周几",renderFormItem:()=>(0,l.jsx)(a.aEE,{options:[{label:"周一",value:1},{label:"周二",value:2},{label:"周三",value:3},{label:"周四",value:4},{label:"周五",value:5},{label:"周六",value:6},{label:"周日",value:0}]})},{dataIndex:"dayOfMonth",title:"几号",renderFormItem:()=>(0,l.jsx)(a.aEE,{options:Array(31).fill(!0).map((e,t)=>({label:t+1+"",value:t+1}))})}]})}),m=e=>{let{id:t,initialValues:r={enabled:!0},groupId:i,onSuccess:o}=e,{form:d,formValues:p,formProps:m}=(0,u.useForm)(),y=(0,n.useRef)(null),g=(0,n.useRef)(null),[f,{setFalse:v,setTrue:h}]=(0,u.useBoolean)(),{createState:x,updateState:F}=(0,s.Fe)({list:!1,create:{onSuccess:()=>{v(),null==o||o()}},update:{onSuccess:()=>{v(),null==o||o()}}}),E=async()=>{var e,r;await Promise.all([d.validateFields(),null===(e=g.current)||void 0===e?void 0:e.validateFields(),null===(r=y.current)||void 0===r?void 0:r.validateFields()]);let l=d.getFieldsValue();if(t){F.mutate(t,l);return}x.mutate({groupId:i,sort:99,...l})};return(0,l.jsxs)(l.Fragment,{children:[t?(0,l.jsx)("span",{onClick:h,children:"修改"}):(0,l.jsx)(a.$nd,{type:"dashed",shape:"circle",size:"large",icon:(0,l.jsx)(a.bW0,{}),onClick:h}),(0,l.jsx)(a.aFV,{title:t?"修改 [".concat(r.name,"]"):"新建习惯",open:f,onOk:E,onCancel:v,children:(0,l.jsx)(a.kyL,{form:d,submitter:!1,initialValues:r,onValuesChange:m.onValuesChange,columns:[{title:"启用",dataIndex:"enabled",valueType:"switch"},{title:"名称",dataIndex:"name",formItemProps:{rules:[{required:!0},{max:8}]}},{dataIndex:"frequency",renderFormItem:()=>(0,l.jsx)(b,{ref:g})},{title:"数量",dataIndex:"count",dependencies:["frequency"],renderFormItem:()=>(0,l.jsx)(c,{ref:y,type:null==p?void 0:p.frequency.type})}]})})]})},y=e=>{let{id:t,onSuccess:r}=e,{removeState:n}=(0,s.Fe)({list:!1,remove:{onSuccess:r}});return(0,l.jsx)(a.iS5,{title:"确定要删除吗？",okText:"确定",cancelText:"取消",onConfirm:()=>n.mutate(t),children:(0,l.jsx)("span",{children:"删除"})})};var g=r(47777),f=r.n(g);let v=e=>{let{data:t,groupId:r,onSuccess:n}=e,{isHovered:s,onMouseEnter:i,onMouseLeave:d}=(0,u.useHovered)(),c=e=>[{key:"edit",label:(0,l.jsx)(m,{id:e.id,groupId:r,initialValues:e,onSuccess:n})},{key:"delete",danger:!0,label:(0,l.jsx)(y,{id:e.id,onSuccess:n})}];return(0,l.jsx)("div",{onMouseEnter:i,onMouseLeave:d,children:(0,l.jsx)(a.BbE,{direction:"horizontal",droppableId:"group-".concat(r),list:(null==t?void 0:t.sort((e,t)=>(e.sort||0)-(t.sort||0)))||[],hasContext:!1,dropType:"habit",lastChildren:(0,l.jsx)("div",{className:"transition-opacity duration-300 ".concat(s?"opacity-100":"opacity-0"),children:(0,l.jsx)(m,{groupId:r,onSuccess:n})}),children:(e,t)=>(0,l.jsx)("div",{className:f().menu,children:(0,l.jsx)(a.msM,{getPopupContainer:e=>e,trigger:["contextMenu"],menu:{items:c(e)},children:(0,l.jsx)("div",{...t.dragHandleProps,children:(0,l.jsx)(o.D,{data:e,mode:p.HabitStatusMode.Habit})})})})})})},h=(0,r(85493).vt)(e=>({filterValues:{enabled:void 0},setFilterValues:t=>{e(e=>({filterValues:{...e.filterValues,...t}}))}})),x=e=>{let{item:t,provided:r,onSuccess:n}=e,{filterValues:o}=h(),{isHovered:d,onMouseEnter:c,onMouseLeave:p}=(0,u.useHovered)(),{removeState:b}=(0,s.LX)({list:!1,remove:{onSuccess:n}}),m=void 0===o.enabled?t.children:(t.children||[]).filter(e=>e.enabled===o.enabled);return(0,l.jsx)(a.ZpM,{size:"small",title:(0,l.jsx)(i,{item:t,onSuccess:n}),onMouseEnter:c,onMouseLeave:p,extra:(0,l.jsxs)(a.$xS,{className:"transition-opacity duration-300 ".concat(d?"opacity-100":"opacity-0"),children:[(0,l.jsx)(a.duJ,{...r.dragHandleProps,className:"cursor-grab"}),(0,l.jsx)(a.iS5,{title:"确定要删除吗？",okText:"确定",cancelText:"取消",onConfirm:()=>b.mutate(t.id),children:(0,l.jsx)(a.SUY,{className:"cursor-pointer"})})]}),children:(0,l.jsx)(v,{groupId:t.id,data:m,onSuccess:n})})};var F=r(38993);let E=e=>{let{list:t,onSuccess:r}=e,n=F.F.useUtils(),s=F.F.custom.habitGroup.updateSort.useMutation({onSuccess:r}),i=F.F.custom.habitItem.updateSort.useMutation({onSuccess:r});return(0,l.jsx)(a.BbE,{list:t,dropType:"group",onDragEnd:e=>{if(e.destination){if("group"===e.type){let r=Array.from(t||[]),[l]=r.splice(e.source.index,1);l&&r.splice(e.destination.index,0,l),n.habitGroup.findMany.setData({orderBy:{sort:"asc"},include:{children:!0}},r),s.mutate(r.map((e,t)=>({id:e.id,sort:t})))}if("habit"===e.type){let r=e.source.droppableId.replace("group-",""),l=e.destination.droppableId.replace("group-",""),a=null==t?void 0:t.find(e=>e.id===r),s=null==t?void 0:t.find(e=>e.id===l);if(!a||!s)return;let o=Array.from(a.children||[]),u=Array.from(s.children||[]),[d]=o.splice(e.source.index,1);if(!d)return;u.splice(e.destination.index,0,{...d,groupId:l});for(let e=0;e<u.length;e++)u[e].sort=e;n.habitGroup.findMany.setData({orderBy:{sort:"asc"},include:{children:!0}},null==t?void 0:t.map(e=>e.id===r?{...e,children:o}:e.id===l?{...e,children:u}:e)),i.mutate([...o.map((e,t)=>({id:e.id,sort:t,groupId:r})),...u.map((e,t)=>({id:e.id,sort:t,groupId:l}))])}}},children:(e,t)=>(0,l.jsx)(x,{item:e,provided:t,onSuccess:r},e.id)})},j=e=>{let{onSuccess:t}=e,[r]=a.lVW.useForm(),[n,{setTrue:i,setFalse:o}]=(0,u.useBoolean)(!1),{createState:d}=(0,s.LX)({list:!1,create:{onSuccess:()=>{o(),null==t||t()}}}),c=async()=>{var e;await r.validateFields();let t=r.getFieldsValue();t.color=null===(e=t.color)||void 0===e?void 0:e.toHex(),d.mutate({...t,sort:99})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.aFV,{title:"创建分组",open:n,onCancel:o,onOk:c,children:(0,l.jsx)(a.kyL,{form:r,submitter:!1,layout:"horizontal",columns:[{title:"标题",dataIndex:"name",formItemProps:{rules:[{required:!0,message:"请输入标题"}]}},{title:"颜色",dataIndex:"color",valueType:"color",fieldProps:{showText:!0,style:{width:110,display:"flex"},presets:[{label:"暖色系",colors:["#FF6B6B","#FFB347","#FF8C42","#FFA07A","#FF7F50","#FF6347","#FF4500","#FF8066"],defaultOpen:!0,key:"warm"},{label:"冷色系",colors:["#4ECDC4","#45B7D1","#96CEB4","#2F9BC1","#5F9EA0","#4682B4","#6495ED","#1E90FF"],defaultOpen:!0,key:"cool"},{label:"柔和色系",colors:["#FFEEAD","#D4A5A5","#9B89B3","#79BD9A","#A8D8B9","#E6B89C","#B4A8C4","#CFB997"],defaultOpen:!0,key:"soft"},{label:"优雅色系",colors:["#DDA0DD","#9370DB","#BA55D3","#8B008B","#C71585","#800080","#663399","#D87093"],defaultOpen:!0,key:"elegant"},{label:"梦幻色系",colors:["#E6E6FA","#B0E0E6","#F0E68C","#FFB6C1","#DDA0DD","#E0FFFF","#FFF0F5","#FFE4E1"],defaultOpen:!0,key:"dreamy"}]}}]})}),(0,l.jsx)(a.$nd,{type:"primary",icon:(0,l.jsx)(a.bW0,{}),onClick:i,children:"添加习惯分组"})]})};var S=r(80108);let D=()=>{let{filterValues:e,setFilterValues:t}=h(),{listState:r}=(0,s.LX)({list:{query:{orderBy:{sort:"asc"},include:{children:!0}}}});return(0,l.jsxs)("div",{className:"p-5 max-w-4xl mx-auto",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h1",{className:"text-2xl font-medium text-gray-900",children:"习惯管理"}),(0,l.jsx)(j,{onSuccess:r.refetch})]}),(0,l.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,l.jsx)(a.aaP,{value:e.enabled,options:S.c,onChange:e=>t({enabled:e})})}),(0,l.jsx)(a.tKH,{spinning:r.isLoading,delay:100,children:(0,l.jsx)(E,{list:r.data,onSuccess:r.refetch})})]})}},66259:(e,t,r)=>{"use strict";r.d(t,{GX:()=>a,dw:()=>s,Rx:()=>n,dF:()=>i,xW:()=>o});var l=r(92211);let n={[l.HabitProgressStatus.Disabled]:"已禁用",[l.HabitProgressStatus.Enabled]:"已启用",[l.HabitProgressStatus.Pending]:"待开始",[l.HabitProgressStatus.Doing]:"进行中",[l.HabitProgressStatus.Done]:"已完成",[l.HabitProgressStatus.Failed]:"已失败"},a={[l.HabitFrequencyType.DAILY]:"每日",[l.HabitFrequencyType.WEEKLY]:"每周",[l.HabitFrequencyType.MONTHLY]:"每月"},s={[l.HabitFrequencyType.DAILY]:"日",[l.HabitFrequencyType.WEEKLY]:"周",[l.HabitFrequencyType.MONTHLY]:"月"},i={[l.HabitProgressStatus.Enabled]:{bg:"bg-blue-500 hover:bg-blue-600",ring:""},[l.HabitProgressStatus.Disabled]:{bg:"bg-gray-400 hover:bg-gray-500",ring:""},[l.HabitProgressStatus.Pending]:{bg:"bg-gray-300 hover:bg-gray-400",ring:""},[l.HabitProgressStatus.Done]:{bg:"bg-green-500 hover:bg-green-600",ring:""},[l.HabitProgressStatus.Doing]:{bg:"bg-yellow-500 hover:bg-yellow-600",ring:"text-yellow-300"},[l.HabitProgressStatus.Failed]:{bg:"text-red-300 hover:bg-red-600",ring:"bg-red-500"}},o=[{label:"复制粘贴",value:l.ButtonsType.Copy},{label:"执行命令",value:l.ButtonsType.Command}]},80108:(e,t,r)=>{"use strict";r.d(t,{c:()=>l});let l=[{label:"全部",value:void 0},{label:"启用",value:!0},{label:"禁用",value:!1}]},84509:(e,t,r)=>{"use strict";e.exports=r(99172)},85493:(e,t,r)=>{"use strict";r.d(t,{vt:()=>c});var l=r(26768),n=r(7620),a=r(84509);let{useDebugValue:s}=n,{useSyncExternalStoreWithSelector:i}=a,o=!1,u=e=>e,d=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?(0,l.y)(e):e,r=(e,r)=>(function(e,t=u,r){r&&!o&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),o=!0);let l=i(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return s(l),l})(t,e,r);return Object.assign(r,t),r},c=e=>e?d(e):d},92211:(e,t,r)=>{"use strict";r.d(t,{ButtonsType:()=>s,CollectingType:()=>i,HabitFrequencyType:()=>l,HabitProgressStatus:()=>n,HabitStatusMode:()=>a,RssFeedActionType:()=>o.lQ,RssFetchTriggerType:()=>o.ln,RssFrequency:()=>o.b4,RssItemActionType:()=>o._1});var l=function(e){return e.DAILY="DAILY",e.WEEKLY="WEEKLY",e.MONTHLY="MONTHLY",e}({}),n=function(e){return e.Disabled="disabled",e.Enabled="enabled",e.Pending="pending",e.Doing="doing",e.Done="done",e.Failed="failed",e}({}),a=function(e){return e.Habit="habit",e.Record="record",e}({});r(93657);var s=function(e){return e.Command="command",e.Copy="copy",e}({}),i=function(e){return e.Url="url",e.Prompt="prompt",e.Copy="copywriter",e}({}),o=r(29392)},93657:()=>{},99172:(e,t,r)=>{"use strict";var l=r(7620),n=r(13100),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=n.useSyncExternalStore,i=l.useRef,o=l.useEffect,u=l.useMemo,d=l.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,l,n){var c=i(null);if(null===c.current){var p={hasValue:!1,value:null};c.current=p}else p=c.current;var b=s(e,(c=u(function(){function e(e){if(!o){if(o=!0,s=e,e=l(e),void 0!==n&&p.hasValue){var t=p.value;if(n(t,e))return i=t}return i=e}if(t=i,a(s,e))return t;var r=l(e);return void 0!==n&&n(t,r)?(s=e,t):(s=e,i=r)}var s,i,o=!1,u=void 0===r?null:r;return[function(){return e(t())},null===u?void 0:function(){return e(u())}]},[t,r,l,n]))[0],c[1]);return o(function(){p.hasValue=!0,p.value=b},[b]),d(b),b}}},e=>{var t=t=>e(e.s=t);e.O(0,[6854,6410,541,6771,2602,1598,1815,8259,1210,2998,6502,5888,4030,794,9223,4033,9565,2983,3651,1026,959,5229,5533,667,587,8315,7358],()=>t(48881)),_N_E=e.O()}]);