(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[817],{11971:(e,t,r)=>{Promise.resolve().then(r.bind(r,65108))},25381:(e,t,r)=>{"use strict";r.d(t,{D:()=>o});var n=r(54568),l=r(7620),s=r(53979);let a=e=>{if(e.length<=3)return e;let t=Math.min(3,Math.ceil(e.length/2));return e.substring(0,t)+"\n"+a(e.substring(t))};var i=r(66259),u=r(92211);let o=e=>{var t,r,o,d,c,v;let{data:b,mode:f}=e,y=(0,l.useRef)(null),g=null!==(d=null==b?void 0:null===(t=b.record)||void 0===t?void 0:t.progress)&&void 0!==d?d:0,m=null!==(v=null!==(c=null==b?void 0:null===(r=b.status)||void 0===r?void 0:r[f])&&void 0!==c?c:b.enabled?u.HabitProgressStatus.Enabled:u.HabitProgressStatus.Disabled)&&void 0!==v?v:u.HabitProgressStatus.Pending;(0,l.useEffect)(()=>{y.current=m},[m]);let p=m===u.HabitProgressStatus.Done&&y.current!==u.HabitProgressStatus.Done,h=null==b?void 0:b.frequency.type,x=i.dw[h];return(0,n.jsx)(s.Exy,{color:"#f50",count:h!==u.HabitFrequencyType.DAILY?x:"",offset:[-8,8],style:{zoom:.9},children:(0,n.jsx)(s.Wlx,{colors:i.dF[m],progress:null===(o=b.record)||void 0===o?void 0:o.progress,showRing:g>0&&g<1,className:p?"animate-complete":"",children:a(b.name)})})}},26768:(e,t,r)=>{"use strict";r.d(t,{y:()=>l});let n=e=>{let t;let r=new Set,n=(e,n)=>{let l="function"==typeof e?e(t):e;if(!Object.is(l,t)){let e=t;t=(null!=n?n:"object"!=typeof l||null===l)?l:Object.assign({},t,l),r.forEach(r=>r(t,e))}},l=()=>t,s={setState:n,getState:l,getInitialState:()=>a,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},a=t=e(n,l,s);return s},l=e=>e?n(e):n},29392:(e,t,r)=>{"use strict";r.d(t,{_1:()=>s,b4:()=>n,lQ:()=>a,ln:()=>l});var n=function(e){return e.Minutes5="minutes5",e.Minutes10="minutes10",e.Minutes20="minutes20",e.Minutes30="minutes30",e.Hourly="hourly",e.Daily="daily",e.Weekly="weekly",e}({}),l=function(e){return e.Manual="manual",e.Scheduled="scheduled",e}({}),s=function(e){return e.MarkAsRead="markAsRead",e.MarkAsUnread="markAsUnread",e.Star="star",e.Unstar="unstar",e.OpenLink="openLink",e}({}),a=function(e){return e.Edit="edit",e.Delete="delete",e.Enable="enable",e.Disable="disable",e.Fetch="fetch",e}({})},65108:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>H});var n=r(54568),l=r(7620),s=r(53979),a=r(25381),i=r(45447);let u=e=>{var t;return{count:(null===(t=e.count)||void 0===t?void 0:t.single)||1,time:(0,i.yf)().format("YYYY-MM-DD HH:mm:ss")}},o=(e,t)=>null==e?void 0:e.filter(e=>{var r;return(null===(r=e.frequency)||void 0===r?void 0:r.type)===t}).length,d=(0,l.forwardRef)((e,t)=>{var r,l;let{data:a}=e,[i]=s.lVW.useForm();return(0,n.jsx)("div",{className:"mt-5",children:(0,n.jsxs)(s.lVW,{ref:t,form:i,labelCol:{span:4},initialValues:{execList:null==a?void 0:null===(r=a.record)||void 0===r?void 0:r.execList,reason:null==a?void 0:null===(l=a.record)||void 0===l?void 0:l.reason},children:[(0,n.jsx)(s.lVW.Item,{label:"执行记录",children:(0,n.jsx)(s.lVW.List,{name:"execList",children:(e,t)=>{let{add:r,remove:l}=t;return(0,n.jsxs)(n.Fragment,{children:[e.map(e=>{let{key:t,name:r,...a}=e;return(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)(s.A9v,{children:[(0,n.jsx)(s.lVW.Item,{...a,name:[r,"count"],rules:[{required:!0,message:"请输入数量"}],children:(0,n.jsx)(s.YIz,{min:1,placeholder:"数量"})}),(0,n.jsx)(s.lVW.Item,{...a,name:[r,"time"],rules:[{required:!0,message:"请选择日期"}],children:(0,n.jsx)(s.pde,{disabled:!0})}),(0,n.jsx)(s.lVW.Item,{...a,name:[r,"feeling"],children:(0,n.jsx)(s.l6P,{placeholder:"完成感受",options:[{label:"非常棒",value:"excellent"},{label:"不错",value:"good"},{label:"一般",value:"normal"},{label:"不太好",value:"bad"},{label:"很差",value:"terrible"}]})}),(0,n.jsx)(s.lVW.Item,{children:(0,n.jsx)(s.$nd,{type:"text",danger:!0,onClick:()=>l(r),children:"删除"})})]})},t)}),(0,n.jsx)(s.$nd,{onClick:()=>r(u(a)),type:"dashed",block:!0,children:"添加记录"})]})}})}),(0,n.jsx)(s.lVW.Item,{name:"reason",label:"未完成原因",children:(0,n.jsx)(s.pde.TextArea,{placeholder:"请输入未完成的原因（选填）",rows:3})})]})})}),c=(0,r(85493).vt)(e=>({selectedDate:(0,i.yf)().startOf("day"),setSelectedDate:t=>{e({selectedDate:t.startOf("day")})},filterValues:{frequency:null,status:null},setFilterValues:t=>{e(e=>({filterValues:{...e.filterValues,...t}}))}}));var v=r(30538),b=r(20667),f=r(92211);let y=e=>{let{list:t,onSuccess:r}=e,i=(0,l.useRef)(null),{selectedDate:o}=c(),{createState:y,updateState:g}=(0,b.z)({showTip:!1,list:!1}),m=async(e,t)=>{if(t.execList){if(!e.record){await y.mutateAsync({habitId:e.id,execList:t.execList,date:o.toDate()}),null==r||r(e);return}await g.mutateAsync(e.record.id,{execList:t.execList,reason:t.reason}),null==r||r(e)}},p=(0,v.useClick)({onClick:e=>{var t,r;if(Number(null===(t=e.record)||void 0===t?void 0:t.progress)>=1)return;let n=(null===(r=e.record)||void 0===r?void 0:r.execList)||[];n.push(u(e)),m(e,{execList:n})},onDoubleClick:e=>{s.aFV.confirm({title:"习惯 [".concat(e.name,"]"),width:600,content:(0,n.jsx)(d,{ref:i,data:e}),onOk:async()=>{var t,r;await (null===(t=i.current)||void 0===t?void 0:t.validateFields()),m(e,null===(r=i.current)||void 0===r?void 0:r.getFieldsValue())}})}});return(0,n.jsx)(s.A9v,{children:t.sort((e,t)=>e.sort-t.sort).map(e=>{var t;return(0,n.jsx)("div",{onClick:()=>p(e),children:(0,n.jsx)(a.D,{data:e,mode:f.HabitStatusMode.Record})},"".concat(e.id,"-").concat(null===(t=e.record)||void 0===t?void 0:t.id))})})},g=e=>{let{data:t,onSuccess:r}=e;return(0,n.jsx)(s.A9v,{direction:"vertical",children:null==t?void 0:t.map(e=>(0,n.jsx)(s.ZpM,{size:"small",title:e.group.name,children:(0,n.jsx)(y,{list:e.list,onSuccess:r})},e.group.id))})};var m=r(38993);let p=e=>{let t=m.F.custom.habitItem.list.useQuery({date:e.valueOf()}),r=e.subtract(1,"day").valueOf(),n=e.add(1,"day").valueOf(),s=m.F.useUtils();return(0,l.useEffect)(()=>{s.custom.habitItem.list.prefetch({date:r}),s.custom.habitItem.list.prefetch({date:n})},[s,n,r]),{data:t.data,refetch:t.refetch,isLoading:t.isLoading,invalidate:t=>{var l;s.custom.habitItem.list.refetch({date:e.valueOf()}),(null===(l=t.frequency)||void 0===l?void 0:l.type)!==f.HabitFrequencyType.DAILY&&(s.custom.habitItem.list.refetch({date:r}),s.custom.habitItem.list.refetch({date:n}))}}};var h=r(66259);let x=(e,t)=>({options:(0,l.useMemo)(()=>({frequency:Object.keys(i._.groupBy(e,e=>{var t;return null===(t=e.frequency)||void 0===t?void 0:t.type})).map(t=>({label:h.GX[t]+" (".concat(o(e,t),")"),value:t})),status:[{label:"全部",value:null},...Object.keys(i._.groupBy(null==e?void 0:e.filter(e=>{var r;return(null===(r=e.frequency)||void 0===r?void 0:r.type)===(null==t?void 0:t.frequency)}),e=>{var t;return null===(t=e.status)||void 0===t?void 0:t.record})).map(e=>({label:h.Rx[e],value:e}))]}),[e,null==t?void 0:t.frequency])}),j=(e,t)=>({showData:(0,l.useMemo)(()=>{let r=null==e?void 0:e.filter(e=>{var r;return(null==t||!t.frequency||(null===(r=e.frequency)||void 0===r?void 0:r.type)===t.frequency)&&(null==t||!t.status||e.status.record===t.status)});return Object.entries(i._.groupBy(r,e=>e.groupId)).map(e=>{let[,t]=e;return{group:t[0].group,list:t}}).sort((e,t)=>{var r,n;return((null===(r=e.group)||void 0===r?void 0:r.sort)||0)-((null===(n=t.group)||void 0===n?void 0:n.sort)||0)})},[e,t])}),S=()=>{let{selectedDate:e,setSelectedDate:t}=c();return{selectedDate:e,setSelectedDate:t}},D=()=>{let{filterValues:e,setFilterValues:t}=c();return{filterValues:e,setFilterValues:t}},H=()=>{let{selectedDate:e,setSelectedDate:t}=S(),{filterValues:r,setFilterValues:a}=D(),{data:i,isLoading:u,invalidate:o}=p(e),{options:d}=x(i,r),{showData:c}=j(i,r);return(0,l.useEffect)(()=>{var e,t,n,l;d.frequency.some(e=>e.value===r.frequency)||(null===(t=d.frequency)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.value)===void 0||a({frequency:d.frequency[0].value}),d.status.some(e=>e.value===r.status)||(null===(l=d.status)||void 0===l?void 0:null===(n=l[0])||void 0===n?void 0:n.value)===void 0||a({status:d.status[0].value})},[r.frequency,r.status,d,a]),(0,n.jsxs)("div",{className:"p-5 max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-medium text-gray-900",children:"习惯记录"}),(0,n.jsx)(s.qJP,{value:e,onChange:t})]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,n.jsx)(s.aaP,{value:r.frequency,options:d.frequency,onChange:e=>a({frequency:e})}),(0,n.jsx)(s.aaP,{value:r.status,options:d.status,onChange:e=>a({status:e})})]}),(0,n.jsx)(s.tKH,{spinning:u,delay:100,children:(0,n.jsx)(g,{data:c,onSuccess:o})})]})}},66259:(e,t,r)=>{"use strict";r.d(t,{GX:()=>s,dw:()=>a,Rx:()=>l,dF:()=>i,xW:()=>u});var n=r(92211);let l={[n.HabitProgressStatus.Disabled]:"已禁用",[n.HabitProgressStatus.Enabled]:"已启用",[n.HabitProgressStatus.Pending]:"待开始",[n.HabitProgressStatus.Doing]:"进行中",[n.HabitProgressStatus.Done]:"已完成",[n.HabitProgressStatus.Failed]:"已失败"},s={[n.HabitFrequencyType.DAILY]:"每日",[n.HabitFrequencyType.WEEKLY]:"每周",[n.HabitFrequencyType.MONTHLY]:"每月"},a={[n.HabitFrequencyType.DAILY]:"日",[n.HabitFrequencyType.WEEKLY]:"周",[n.HabitFrequencyType.MONTHLY]:"月"},i={[n.HabitProgressStatus.Enabled]:{bg:"bg-blue-500 hover:bg-blue-600",ring:""},[n.HabitProgressStatus.Disabled]:{bg:"bg-gray-400 hover:bg-gray-500",ring:""},[n.HabitProgressStatus.Pending]:{bg:"bg-gray-300 hover:bg-gray-400",ring:""},[n.HabitProgressStatus.Done]:{bg:"bg-green-500 hover:bg-green-600",ring:""},[n.HabitProgressStatus.Doing]:{bg:"bg-yellow-500 hover:bg-yellow-600",ring:"text-yellow-300"},[n.HabitProgressStatus.Failed]:{bg:"text-red-300 hover:bg-red-600",ring:"bg-red-500"}},u=[{label:"复制粘贴",value:n.ButtonsType.Copy},{label:"执行命令",value:n.ButtonsType.Command}]},84509:(e,t,r)=>{"use strict";e.exports=r(99172)},85493:(e,t,r)=>{"use strict";r.d(t,{vt:()=>c});var n=r(26768),l=r(7620),s=r(84509);let{useDebugValue:a}=l,{useSyncExternalStoreWithSelector:i}=s,u=!1,o=e=>e,d=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?(0,n.y)(e):e,r=(e,r)=>(function(e,t=o,r){r&&!u&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),u=!0);let n=i(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return a(n),n})(t,e,r);return Object.assign(r,t),r},c=e=>e?d(e):d},92211:(e,t,r)=>{"use strict";r.d(t,{ButtonsType:()=>a,CollectingType:()=>i,HabitFrequencyType:()=>n,HabitProgressStatus:()=>l,HabitStatusMode:()=>s,RssFeedActionType:()=>u.lQ,RssFetchTriggerType:()=>u.ln,RssFrequency:()=>u.b4,RssItemActionType:()=>u._1});var n=function(e){return e.DAILY="DAILY",e.WEEKLY="WEEKLY",e.MONTHLY="MONTHLY",e}({}),l=function(e){return e.Disabled="disabled",e.Enabled="enabled",e.Pending="pending",e.Doing="doing",e.Done="done",e.Failed="failed",e}({}),s=function(e){return e.Habit="habit",e.Record="record",e}({});r(93657);var a=function(e){return e.Command="command",e.Copy="copy",e}({}),i=function(e){return e.Url="url",e.Prompt="prompt",e.Copy="copywriter",e}({}),u=r(29392)},93657:()=>{},99172:(e,t,r)=>{"use strict";var n=r(7620),l=r(13100),s="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=l.useSyncExternalStore,i=n.useRef,u=n.useEffect,o=n.useMemo,d=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,n,l){var c=i(null);if(null===c.current){var v={hasValue:!1,value:null};c.current=v}else v=c.current;var b=a(e,(c=o(function(){function e(e){if(!u){if(u=!0,a=e,e=n(e),void 0!==l&&v.hasValue){var t=v.value;if(l(t,e))return i=t}return i=e}if(t=i,s(a,e))return t;var r=n(e);return void 0!==l&&l(t,r)?(a=e,t):(a=e,i=r)}var a,i,u=!1,o=void 0===r?null:r;return[function(){return e(t())},null===o?void 0:function(){return e(o())}]},[t,r,n,l]))[0],c[1]);return u(function(){v.hasValue=!0,v.value=b},[b]),d(b),b}}},e=>{var t=t=>e(e.s=t);e.O(0,[6854,6410,541,6771,2602,1598,1815,8259,1210,2998,6502,5888,4030,794,9223,4033,9565,2983,3651,1026,959,5229,5533,667,587,8315,7358],()=>t(11971)),_N_E=e.O()}]);