(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8959],{1225:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>m});var s=l(54568),n=l(7620),a=l(53979),r=l(20667),i=l(30538);let d=e=>{let{initialValues:t,onSuccess:l}=e,[d]=a.lVW.useForm(),[c,{setTrue:o,setFalse:u}]=(0,i.useBoolean)(!1),[h,m]=(0,n.useState)("edit"),[x,b]=(0,n.useState)(""),{listState:f}=(0,r.sk)({list:{query:{where:{enabled:!0},orderBy:{createdAt:"desc"}}}}),v=(0,n.useMemo)(()=>{let e=x,t=f.data||[];return x&&t.length>0&&(e=x.replace(/@([^\n@]+?)(?=\n|@|$)/g,(e,l)=>{let s=l.trim(),n=t.find(e=>e.title===s);return n&&n.content||e})),e},[x,f.data]),{createState:j,updateState:p}=(0,r.wy)({list:!1,create:{onSuccess:()=>{g(),null==l||l()}},update:{onSuccess:()=>{g(),null==l||l()}}});(0,n.useEffect)(()=>{if(t&&c){let e={title:t.title,content:t.content,tags:t.tags||[],project:t.project||void 0,enabled:void 0===t.enabled||t.enabled};d.setFieldsValue(e),b(e.content)}else d.resetFields(),b("")},[d,t,c]);let g=()=>{u(),d.resetFields(),m("edit"),b("")},y=async()=>{await d.validateFields();let e=d.getFieldsValue();(null==t?void 0:t.id)?p.mutate(t.id,e):j.mutate(e)},w=(f.data||[]).map(e=>({key:e.id,value:e.title,label:e.title}));return(0,s.jsxs)(s.Fragment,{children:[t?(0,s.jsx)(a.$nd,{type:"text",icon:(0,s.jsx)(a.xjh,{}),onClick:o}):(0,s.jsx)(a.$nd,{type:"primary",icon:(0,s.jsx)(a.bW0,{}),onClick:o,children:"添加角色"}),(0,s.jsx)(a._s,{title:t?"编辑角色":"新建角色",open:c,onClose:g,width:"80%",extra:(0,s.jsx)(a.$nd,{type:"primary",onClick:y,loading:j.isPending||p.isPending,children:"保存"}),children:(0,s.jsx)(a.tUM,{activeKey:h,onChange:m,items:[{key:"edit",label:"编辑",children:(0,s.jsxs)(a.lVW,{form:d,layout:"horizontal",labelCol:{span:2},wrapperCol:{span:21},initialValues:{enabled:!0},children:[(0,s.jsx)(a.lVW.Item,{name:"enabled",label:"状态",valuePropName:"checked",children:(0,s.jsx)(a.dOG,{})}),(0,s.jsx)(a.lVW.Item,{name:"title",label:"标题",rules:[{required:!0,message:"请输入标题"}],children:(0,s.jsx)(a.pde,{placeholder:"请输入标题"})}),(0,s.jsx)(a.lVW.Item,{name:"tags",label:"标签",rules:[{required:!0,message:"请添加标签"}],children:(0,s.jsx)(a.l6P,{placeholder:"输入标签后按回车",mode:"tags"})}),(0,s.jsx)(a.lVW.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入内容"}],children:(0,s.jsx)(a.MW8,{placeholder:"请输入内容，输入 @ 可以提及信息项",autoSize:{minRows:15,maxRows:27},options:w,onChange:e=>{b(e),d.setFieldValue("content",e)}})})]})},{key:"preview",label:"预览",children:(0,s.jsx)("div",{className:"p-4 border rounded-md bg-white overflow-y-auto h-[830px]",children:(0,s.jsx)(a.ozN,{content:v})})}]})})]})},c=e=>{let{id:t,onSuccess:l}=e,{removeState:n}=(0,r.wy)({list:!1,remove:{onSuccess:l}});return(0,s.jsx)(a.iS5,{title:"确定删除该角色吗？",onConfirm:()=>{n.mutate(t)},okText:"确定",cancelText:"取消",children:(0,s.jsx)(a.$nd,{type:"link",danger:!0,icon:(0,s.jsx)(a.SUY,{})})})},o=e=>{let{list:t,onSuccess:l}=e,{updateState:n}=(0,r.wy)({list:!1,update:{onSuccess:l}}),{listState:i}=(0,r.sk)({list:{query:{where:{enabled:!0},orderBy:{createdAt:"desc"}}}}),o=e=>{let t=e,l=i.data||[];return e&&l.length>0&&(t=e.replace(/@([^\n@]+?)(?=\n|@|$)/g,(e,t)=>{let s=t.trim(),n=l.find(e=>e.title===s);return n&&n.content||e})),t},u=(e,t)=>{n.mutate(t.id,{enabled:e})},h=e=>{let t=o(e);navigator.clipboard.writeText(t),a.iUO.success("内容已复制")};return(0,s.jsx)(a.fI1,{gutter:[16,16],children:(t||[]).map(e=>{var t,n;return(0,s.jsx)(a.fvL,{xs:24,md:12,lg:8,children:(0,s.jsxs)(a.ZpM,{size:"small",title:e.title,extra:(0,s.jsx)(a.dOG,{size:"small",checked:e.enabled,onChange:t=>u(t,e)}),actions:[(0,s.jsx)(a.$nd,{type:"text",icon:(0,s.jsx)(a.wq3,{}),onClick:()=>h(e.content),title:"复制内容"},"copy"),(0,s.jsx)(d,{initialValues:e,onSuccess:l},"edit"),(0,s.jsx)(c,{id:e.id,onSuccess:l},"delete")],children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(null===(t=e.tags)||void 0===t?void 0:t.length)>0&&(0,s.jsx)("div",{className:"mb-3",children:null===(n=e.tags)||void 0===n?void 0:n.map(e=>(0,s.jsx)(a.vwO,{className:"mr-1 mb-1",children:e},e))}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)(a.vwO,{color:e.enabled?"success":"error",children:e.enabled?"启用":"禁用"})})]}),(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)(a.o5u.Paragraph,{ellipsis:{rows:5},children:e.content})}),e.project&&(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsx)("strong",{className:"mr-1",children:"项目:"}),(0,s.jsx)("span",{children:e.project})]})]})},e.id)})})};var u=l(80108);let h=(0,l(85493).vt)(e=>({filterValues:{enabled:void 0,title:"",tag:""},setFilterValues:t=>{e(e=>({filterValues:{...e.filterValues,...t}}))}})),m=()=>{let{filterValues:e,setFilterValues:t}=h(),l=(0,n.useMemo)(()=>{let t={};return void 0!==e.enabled&&(t.enabled=e.enabled),e.title&&(t.title={contains:e.title}),e.tag&&(t.tags={equals:[e.tag]}),t},[e]),{listState:i}=(0,r.wy)({list:{query:{where:l,orderBy:{createdAt:"desc"}}}}),c=(0,n.useMemo)(()=>{if(!i.data)return[];let e=new Set;return i.data.forEach(t=>{t.tags&&Array.isArray(t.tags)&&t.tags.forEach(t=>e.add(t))}),Array.from(e).map(e=>({label:e,value:e}))},[i.data]);return(0,s.jsxs)("div",{className:"p-5 mx-auto",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-medium text-gray-900",children:"角色管理"}),(0,s.jsx)(d,{onSuccess:i.refetch})]}),(0,s.jsx)("div",{className:"flex justify-between items-center mb-4",children:(0,s.jsxs)("div",{className:"flex items-center gap-4 w-full",children:[(0,s.jsx)(a.aaP,{value:e.enabled,options:u.c,style:{width:300},onChange:e=>t({enabled:e})}),(0,s.jsx)(a.l6P,{placeholder:"根据标签筛选",allowClear:!0,style:{width:300},value:e.tag,options:c,onChange:e=>t({tag:e})}),(0,s.jsx)(a.pde,{placeholder:"搜索标题",allowClear:!0,value:e.title,onChange:e=>t({title:e.target.value})})]})}),(0,s.jsx)(a.tKH,{spinning:i.isLoading,delay:100,children:(0,s.jsx)(o,{list:i.data,onSuccess:i.refetch})})]})}},26768:(e,t,l)=>{"use strict";l.d(t,{y:()=>n});let s=e=>{let t;let l=new Set,s=(e,s)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=s?s:"object"!=typeof n||null===n)?n:Object.assign({},t,n),l.forEach(l=>l(t,e))}},n=()=>t,a={setState:s,getState:n,getInitialState:()=>r,subscribe:e=>(l.add(e),()=>l.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),l.clear()}},r=t=e(s,n,a);return a},n=e=>e?s(e):s},68927:(e,t,l)=>{Promise.resolve().then(l.bind(l,1225))},80108:(e,t,l)=>{"use strict";l.d(t,{c:()=>s});let s=[{label:"全部",value:void 0},{label:"启用",value:!0},{label:"禁用",value:!1}]},84509:(e,t,l)=>{"use strict";e.exports=l(99172)},85493:(e,t,l)=>{"use strict";l.d(t,{vt:()=>u});var s=l(26768),n=l(7620),a=l(84509);let{useDebugValue:r}=n,{useSyncExternalStoreWithSelector:i}=a,d=!1,c=e=>e,o=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?(0,s.y)(e):e,l=(e,l)=>(function(e,t=c,l){l&&!d&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),d=!0);let s=i(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,l);return r(s),s})(t,e,l);return Object.assign(l,t),l},u=e=>e?o(e):o},99172:(e,t,l)=>{"use strict";var s=l(7620),n=l(13100),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},r=n.useSyncExternalStore,i=s.useRef,d=s.useEffect,c=s.useMemo,o=s.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,l,s,n){var u=i(null);if(null===u.current){var h={hasValue:!1,value:null};u.current=h}else h=u.current;var m=r(e,(u=c(function(){function e(e){if(!d){if(d=!0,r=e,e=s(e),void 0!==n&&h.hasValue){var t=h.value;if(n(t,e))return i=t}return i=e}if(t=i,a(r,e))return t;var l=s(e);return void 0!==n&&n(t,l)?(r=e,t):(r=e,i=l)}var r,i,d=!1,c=void 0===l?null:l;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,l,s,n]))[0],u[1]);return d(function(){h.hasValue=!0,h.value=m},[m]),o(m),m}}},e=>{var t=t=>e(e.s=t);e.O(0,[6854,6410,541,6771,2602,1598,1815,8259,1210,2998,6502,5888,4030,794,9223,4033,9565,2983,3651,1026,959,5229,5533,667,587,8315,7358],()=>t(68927)),_N_E=e.O()}]);