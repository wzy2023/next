(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2177],{29392:(e,t,a)=>{"use strict";a.d(t,{_1:()=>r,b4:()=>s,lQ:()=>l,ln:()=>n});var s=function(e){return e.Minutes5="minutes5",e.Minutes10="minutes10",e.Minutes20="minutes20",e.Minutes30="minutes30",e.Hourly="hourly",e.Daily="daily",e.Weekly="weekly",e}({}),n=function(e){return e.Manual="manual",e.Scheduled="scheduled",e}({}),r=function(e){return e.MarkAsRead="markAsRead",e.MarkAsUnread="markAsUnread",e.Star="star",e.Unstar="unstar",e.OpenLink="openLink",e}({}),l=function(e){return e.Edit="edit",e.Delete="delete",e.Enable="enable",e.Disable="disable",e.Fetch="fetch",e}({})},52816:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>V});var s=a(54568),n=a(7620),r=a(53979);let l=e=>e&&!/^https?:\/\//.exec(e)?"http://"+e:e,i=e=>{var t;let a,s;return(null===(t=e.pubDate)||void 0===t?void 0:t.length)===2&&([a,s]=e.pubDate),{search:e.search||"",feedIds:e.feedIds||[],tags:e.tags||[],isRead:e.isRead,isStarred:e.isStarred,pubDateStart:a,pubDateEnd:s}},d=e=>{let t=new Set;return null==e||e.forEach(e=>{e.tags&&Array.isArray(e.tags)&&e.tags.forEach(e=>t.add(e))}),Array.from(t).map(e=>({label:e,value:e}))};var c=a(29392);let o=[{label:"每5分钟",value:c.b4.Minutes5},{label:"每10分钟",value:c.b4.Minutes10},{label:"每20分钟",value:c.b4.Minutes20},{label:"每30分钟",value:c.b4.Minutes30},{label:"每小时",value:c.b4.Hourly},{label:"每天",value:c.b4.Daily},{label:"每周",value:c.b4.Weekly}],u=[{label:"全部",value:void 0},{label:"已读",value:!0},{label:"未读",value:!1}],h=[{label:"全部",value:void 0},{label:"已收藏",value:!0},{label:"未收藏",value:!1}];var m=a(38993);let y=e=>{let{form:t,feeds:a,onSearch:n}=e,l=m.F.custom.rssItem.aiSummary.useMutation({onSuccess:e=>{r.iUO.success(e.message)}}),i=m.F.custom.rssItem.markAllAsRead.useMutation({onSuccess:()=>{n(t.getFieldsValue())}}),c=d(a);return(0,s.jsxs)(r.lVW,{form:t,layout:"inline",onFinish:e=>{n(e)},children:[(0,s.jsx)(r.lVW.Item,{name:"search",children:(0,s.jsx)(r.pde,{placeholder:"搜索标题或内容",allowClear:!0})}),(0,s.jsx)(r.lVW.Item,{name:"tags",children:(0,s.jsx)(r.l6P,{placeholder:"选择来源标签",options:c,mode:"multiple",allowClear:!0,style:{width:120}})}),(0,s.jsx)(r.lVW.Item,{name:"isRead",children:(0,s.jsx)(r.sxL.Group,{options:u,optionType:"button",buttonStyle:"solid"})}),(0,s.jsx)(r.lVW.Item,{name:"isStarred",children:(0,s.jsx)(r.sxL.Group,{options:h,optionType:"button",buttonStyle:"solid"})}),(0,s.jsxs)(r.lVW.Item,{children:[(0,s.jsx)(r.$nd,{type:"primary",htmlType:"submit",children:"搜索"}),(0,s.jsx)(r.$nd,{style:{marginLeft:8},onClick:()=>{t.resetFields(),setTimeout(()=>{n(t.getFieldsValue())},0)},children:"重置"}),(0,s.jsx)(r.$nd,{style:{marginLeft:8},onClick:()=>l.mutate(),loading:l.isPending,children:"AI 摘要"}),(0,s.jsx)(r.$nd,{style:{marginLeft:8},onClick:()=>i.mutate(),loading:i.isPending,children:"全部标为已读"})]})]})};var g=a(92211);let x=e=>{let{record:t,onAction:a}=e;return(0,s.jsxs)(r.$xS,{size:"middle",children:[(0,s.jsx)(r.m_M,{title:t.isRead?"标记为未读":"标记为已读",children:(0,s.jsx)("a",{onClick:()=>{a(t.isRead?g.RssItemActionType.MarkAsUnread:g.RssItemActionType.MarkAsRead,t.id)},children:t.isRead?(0,s.jsx)(r.yKX,{style:{color:"#d9d9d9"}}):(0,s.jsx)(r.E6Q,{style:{color:"#1890ff"}})})}),(0,s.jsx)(r.m_M,{title:t.isStarred?"取消收藏":"收藏",children:(0,s.jsx)("a",{onClick:()=>{a(t.isStarred?g.RssItemActionType.Unstar:g.RssItemActionType.Star,t.id)},children:t.isStarred?(0,s.jsx)(r.BQ2,{style:{color:"#faad14"}}):(0,s.jsx)(r.L0Y,{})})}),(0,s.jsx)(r.m_M,{title:t.isSent?"已发送":"未发送",children:t.isSent?(0,s.jsx)(r.QIx,{style:{color:"#faad14"}}):(0,s.jsx)(r.g1U,{})})]})},p=e=>{let{record:t}=e;return(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"mr-2 flex-none",children:t.isRead?(0,s.jsx)(r.yKX,{style:{color:"#d9d9d9"}}):(0,s.jsx)(r.E6Q,{style:{color:"#1890ff"}})}),(0,s.jsx)("a",{href:l(t.link),target:"_blank",rel:"noopener noreferrer",className:"flex-grow",children:t.title})]})};var f=a(45447);let v=(e,t)=>[{title:"标题",dataIndex:"title",width:"15%",ellipsis:!0,render:(e,t)=>(0,s.jsx)(p,{record:t})},{title:"内容",dataIndex:"summary",render:(e,a)=>{var n;let l=null===(n=a.content)||void 0===n?void 0:n.includes("<img"),i=(0,s.jsx)("div",{className:"max-w-lg max-h-96 overflow-auto",dangerouslySetInnerHTML:{__html:a.content||""}});return(0,s.jsxs)(r.AMh,{content:i,trigger:"hover",placement:"right",overlayClassName:"rss-content-popover",children:[(0,s.jsx)("div",{className:"px-1 max-h-40 overflow-auto",onDoubleClick:()=>{t&&a.id&&t(a.id,!a.isRead)},children:(0,s.jsx)("span",{dangerouslySetInnerHTML:{__html:a.summary||a.title||""}})}),l&&(0,s.jsx)(r.vwO,{children:"是"})]})}},{title:"来源及标签",key:"feedInfo",width:180,render:(e,t)=>{var a,n;return(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:(0,s.jsx)(r.vwO,{children:null===(a=t.feed)||void 0===a?void 0:a.name})}),(0,s.jsx)("div",{className:"mt-1",children:((null===(n=t.feed)||void 0===n?void 0:n.tags)||[]).map(e=>(0,s.jsx)(r.vwO,{children:e},e))})]})}},{title:"AI 标签",dataIndex:"tags",width:150,render:(e,t)=>{let a=t.tags||[];return(0,s.jsx)(s.Fragment,{children:Array.isArray(a)&&a.map(e=>(0,s.jsx)(r.vwO,{children:e},e))})}},{title:"发布时间",dataIndex:"pubDate",width:180,render:e=>(0,f.yf)(e).format("YYYY-MM-DD HH:mm")},{title:"操作",key:"action",width:120,render:(t,a)=>(0,s.jsx)(x,{record:a,onAction:e})}];var j=a(20667);let b=()=>{let{listState:e,createState:t,updateState:a,removeState:s,apiUtils:n}=(0,j.K0)({showTip:!1,list:{query:{where:{isDeleted:!1},orderBy:{createdAt:"desc"}}}});return{feeds:e.data,isLoading:e.isLoading,isError:e.isError,error:e.error,refetch:e.refetch,createFeed:e=>t.mutateAsync(e),updateFeed:(e,t)=>a.mutateAsync(e,t),deleteFeed:e=>s.mutateAsync(e),batchDeleteFeeds:e=>Promise.all(e.map(e=>s.mutateAsync(e))),batchUpdateFeeds:e=>Promise.all(Object.values(e).map(e=>{a.mutateAsync(e.id,e.data)})),apiUtils:n}};var S=a(223),k=a.n(S);let w=function(){var e,t;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{listState:s,updateState:n,apiUtils:r}=(0,j.Bf)({showTip:!1,list:{query:{where:{isDeleted:!1,...a.search?{OR:[{title:{contains:a.search}},{description:{contains:a.search}}]}:{},...(null===(e=a.feedIds)||void 0===e?void 0:e.length)?{feedId:{in:a.feedIds}}:{},...(null===(t=a.tags)||void 0===t?void 0:t.length)?{feed:{tags:{array_contains:a.tags}}}:{},...void 0!==a.isRead?{isRead:a.isRead}:{},...void 0!==a.isStarred?{isStarred:a.isStarred}:{},...a.pubDateStart||a.pubDateEnd?{pubDate:{...a.pubDateStart?{gte:k()(a.pubDateStart).startOf("day").toISOString()}:{},...a.pubDateEnd?{lte:k()(a.pubDateEnd).endOf("day").toISOString()}:{}}}:{}},orderBy:{pubDate:"desc"},include:{feed:{select:{id:!0,name:!0,tags:!0}}}}}});return{items:s.data,isLoading:s.isLoading,isError:s.isError,error:s.error,refetch:s.refetch,toggleRead:(e,t)=>n.mutateAsync(e,{isRead:t}),toggleStar:(e,t)=>n.mutateAsync(e,{isStarred:t}),batchToggleRead:(e,t)=>Promise.all(e.map(e=>n.mutateAsync(e,{isRead:t}))),apiUtils:r}},R=()=>{let[e,t]=(0,n.useState)({search:"",feedIds:[],tags:[],isRead:void 0,isStarred:void 0,pubDateStart:void 0,pubDateEnd:void 0}),{feeds:a}=b(),{items:l,isLoading:d,refetch:c,toggleRead:o,toggleStar:u}=w(e),h=(0,n.useRef)(null),[m]=r.lVW.useForm(),x=async(e,t)=>{await o(e,t),r.iUO.success(t?"标记已读成功":"标记未读成功"),await c(),h.current&&h.current.reload()},p=v(async(e,t)=>{switch(e){case g.RssItemActionType.MarkAsRead:await o(t,!0),r.iUO.success("标记已读成功");break;case g.RssItemActionType.MarkAsUnread:await o(t,!1),r.iUO.success("标记未读成功");break;case g.RssItemActionType.Star:await u(t,!0),r.iUO.success("收藏成功");break;case g.RssItemActionType.Unstar:await u(t,!1),r.iUO.success("取消收藏成功")}await c(),h.current&&h.current.reload()},x);return(0,s.jsxs)("div",{className:"rss-item-table",children:[(0,s.jsx)("div",{className:"mb-3",children:(0,s.jsx)(y,{form:m,feeds:a||[],onSearch:e=>{t(i(e)),c()}})}),(0,s.jsx)(r.iAN,{actionRef:h,rowKey:"id",columns:p,dataSource:l,loading:d,search:!1,options:!1,pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],defaultPageSize:10},onRow:e=>({onDoubleClick:()=>{e.id&&x(e.id,!e.isRead)}})})]})},T=[{value:"jike",label:"即刻",children:[{value:"user",label:"用户"},{value:"topic",label:"圈子"}]}],I={jike:{user:"/jike/user/{value}",topic:"/jike/topic/{value}"}};var A=function(e){return e.CUSTOM="custom",e.SELECT="select",e.BATCH="batch",e}(A||{});let C=e=>{let{currentId:t,value:a,onChange:l,onBatchChange:i}=e,[d,c]=(0,n.useState)("custom"),[o,u]=(0,n.useState)(""),[h,m]=(0,n.useState)([]),[y,g]=(0,n.useState)(""),[x,p]=(0,n.useState)(""),[f,v]=(0,n.useState)("");(0,n.useEffect)(()=>{a&&u(a)},[]),(0,n.useEffect)(()=>{a&&"select"===d&&u(a)},[a,d]),(0,n.useEffect)(()=>{"custom"===d&&l&&l(o)},[o,d,l]),(0,n.useEffect)(()=>{"select"===d&&f&&l&&l(f)},[f,d,l]),(0,n.useEffect)(()=>{if("batch"===d&&l){let e=j(x);e.length>0?l(e[0]||""):l("")}},[x,d,l]);let j=e=>e?e.split("\n").map(e=>e.trim()).filter(e=>e&&e.length>0):[],b=()=>{if(2!==h.length)return"";if(y){var e;let[t,a]=h,s=null===(e=I[t])||void 0===e?void 0:e[a];if(s){let e=s.replace("{value}",y);return v(e),e}}return v(""),""};return(0,s.jsx)(r.tUM,{size:"small",activeKey:d,onChange:e=>c(e),items:[{key:"custom",label:"自定义",children:(0,s.jsx)(r.pde,{placeholder:"请输入RSS链接",value:o,onChange:e=>u(e.target.value)})},{key:"select",label:"选择",children:(0,s.jsxs)("div",{children:[(0,s.jsxs)(r.$xS,{style:{width:"100%"},children:[(0,s.jsx)(r.vxQ,{options:T,placeholder:"选择平台和渠道",onChange:e=>{m(e),v("")}}),(0,s.jsx)(r.pde,{placeholder:"请输入值",value:y,onChange:e=>{g(e.target.value)},onBlur:()=>{b()},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),b())},disabled:2!==h.length})]}),f&&(0,s.jsx)("div",{style:{marginTop:8,color:"#666"},children:f})]})},...t?[]:[{key:"batch",label:"批量",children:(0,s.jsxs)("div",{children:[(0,s.jsx)(r.pde.TextArea,{placeholder:"请输入多个RSS链接，每行一个",value:x,onChange:e=>{let t=e.target.value;p(t),i&&i(j(t))},autoSize:{minRows:3,maxRows:10}}),(0,s.jsxs)("div",{style:{marginTop:8,fontSize:"12px",color:"#666"},children:["已识别 ",j(x).length," 个链接"]})]})}]]})},O=e=>{let{visible:t,currentId:a,record:l,onCancel:i,onSubmit:c}=e,[u]=r.lVW.useForm(),[h,m]=(0,n.useState)([]),[y,x]=(0,n.useState)(!1),{feeds:p,createFeed:f}=b(),v=d(p||[]);(0,n.useEffect)(()=>{t&&l?u.setFieldsValue({name:l.name,url:l.url,frequency:l.frequency,tags:l.tags||[]}):u.resetFields()},[t,l,u]);let j=async()=>{try{let e=await u.validateFields();y&&h.length>0?await S(e):await c(e),u.resetFields()}catch(e){console.error("表单验证失败:",e)}},S=async e=>{if(0===h.length){r.iUO.warning("请至少输入一个有效的RSS链接");return}try{let t={success:0,fail:0};for(let[a,s]of h.entries()){let[n,l]=s.split(" - ");r.iUO.loading("正在批量添加 ".concat(a," / ").concat(h.length," 个RSS订阅..."),0);try{let a={name:"".concat(e.name||"").concat(n||""),url:l,frequency:e.frequency,tags:e.tags||[]};await f(a),t.success++}catch(e){console.error("添加RSS失败: ".concat(l),e),t.fail++}}t.success>0&&r.iUO.success("成功添加 ".concat(t.success," 个RSS订阅")),t.fail>0&&r.iUO.error("".concat(t.fail," 个RSS订阅添加失败")),i()}catch(e){r.iUO.error("批量添加失败"),console.error("批量添加失败:",e)}};return(0,s.jsx)(r.aFV,{title:a?"编辑RSS订阅":"添加RSS订阅",open:t,onCancel:i,onOk:j,destroyOnClose:!0,children:(0,s.jsxs)(r.lVW,{form:u,layout:"vertical",initialValues:{frequency:g.RssFrequency.Minutes10},children:[(0,s.jsx)(r.lVW.Item,{name:"name",label:y?"名称前缀":"名称",rules:[{required:!y,message:"请输入RSS名称"}],children:(0,s.jsx)(r.pde,{placeholder:"请输入RSS名称"})}),(0,s.jsx)(r.lVW.Item,{name:"url",label:"RSS链接",rules:[{required:!y,message:"请输入RSS链接"}],children:(0,s.jsx)(C,{currentId:a,onBatchChange:e=>{m(e),x(e.length>0)}})}),y&&(0,s.jsxs)("div",{style:{marginBottom:16,padding:8,backgroundColor:"#f5f5f5",borderRadius:4},children:[(0,s.jsx)("div",{children:"批量模式说明:"}),(0,s.jsxs)("ul",{style:{marginLeft:20,marginBottom:0},children:[(0,s.jsxs)("li",{children:["识别到 ",h.length," 个链接"]}),(0,s.jsx)("li",{children:'名称将自动使用"输入名称 - 链接末尾标识"命名'}),(0,s.jsx)("li",{children:"所有链接将使用相同的抓取频率和标签"})]})]}),(0,s.jsx)(r.lVW.Item,{name:"frequency",label:"抓取频率",rules:[{required:!0,message:"请选择抓取频率"}],children:(0,s.jsx)(r.l6P,{placeholder:"请选择抓取频率",options:o})}),(0,s.jsx)(r.lVW.Item,{name:"tags",label:"标签",children:(0,s.jsx)(r.l6P,{mode:"tags",placeholder:"请输入标签，按回车确认",options:v})})]})})},F=e=>{let{selectedRowKeys:t,onBatchDelete:a,onBatchEnable:n,onBatchDisable:l}=e;return(0,s.jsx)(r.msM,{menu:{items:[{key:"delete",label:"批量删除",onClick:a},{key:"enable",label:"批量启用",onClick:n},{key:"disable",label:"批量禁用",onClick:l}]},disabled:0===t.length,children:(0,s.jsxs)(r.$nd,{children:["批量操作 ",(0,s.jsx)(r.lHd,{})]})})},M=e=>{let{record:t,onAction:a}=e,[l,i]=(0,n.useState)(!1);return(0,s.jsxs)(r.$xS,{size:"middle",children:[(0,s.jsx)(r.m_M,{title:"编辑",children:(0,s.jsx)("a",{onClick:()=>a(g.RssFeedActionType.Edit,t.id),children:(0,s.jsx)(r.xjh,{})})}),(0,s.jsx)(r.m_M,{title:"删除",children:(0,s.jsx)("a",{onClick:()=>a(g.RssFeedActionType.Delete,t.id),children:(0,s.jsx)(r.SUY,{})})}),(0,s.jsx)(r.m_M,{title:"立即抓取",children:(0,s.jsx)("a",{onClick:()=>{i(!0),a(g.RssFeedActionType.Fetch,t.id),setTimeout(()=>i(!1),1e4)},children:(0,s.jsx)(r.OmY,{spin:l})})})]})},E=e=>{let{record:t,onChange:a}=e;return(0,s.jsx)(r.dOG,{checked:t.enabled,onChange:e=>a(e,t.id)})},U=e=>{let{onAction:t,onEnabledChange:a,getItemCount:n}=e;return[{title:"名称",dataIndex:"name"},{title:"RSS链接",dataIndex:"url",render:e=>(0,s.jsx)("a",{href:"http://localhost:1200"+e,target:"_blank",rel:"noopener noreferrer",children:e})},{title:"标签",dataIndex:"tags",key:"tags",render:e=>(0,s.jsx)(s.Fragment,{children:(e||[]).map(e=>(0,s.jsx)(r.vwO,{children:e},e))})},{title:"频率",dataIndex:"frequency",key:"frequency",render:e=>{let t=o.find(t=>t.value===e);return t?t.label:e}},{title:"文章数",key:"itemCount",render:(e,t)=>n(t.id)},{title:"启用",dataIndex:"enabled",key:"enabled",render:(e,t)=>(0,s.jsx)(E,{record:t,onChange:a})},{title:"操作",key:"action",render:(e,a)=>(0,s.jsx)(M,{record:a,onAction:t})}]},D=(e,t,a)=>{let s="",n=(null==t?void 0:t.reduce((e,t)=>e+t.newItemCount,0))||0;return s+=t.length?"抓取成功的订阅源 (".concat(t.length,")\n"):"",t.forEach(e=>{s+=e.newItemCount?"	".concat(e.name," (").concat(e.newItemCount,")\n"):""}),s+=a.length?"\n抓取失败的订阅源 (".concat(a.length,")\n"):"",a.forEach(e=>{s+="	".concat(e.name," (").concat(e.error,")\n")}),{title:"订阅源 (".concat(e,") 个、新数据 (").concat(n,") 条"),description:s}},N=()=>{let[e,t]=(0,n.useState)([]),[a,l]=(0,n.useState)(),[i,d]=(0,n.useState)(!1),[c,o]=(0,n.useState)(null),u=(0,n.useRef)(null),{feeds:h,isLoading:y,createFeed:x,updateFeed:p,deleteFeed:f,batchDeleteFeeds:v,batchUpdateFeeds:j,refetch:S}=b(),k=m.F.custom.rssFeed.batchFetchNow.useMutation(),w=m.F.custom.rssFeed.getCountByFeed.useQuery();(0,n.useEffect)(()=>{if(a){let e=null==h?void 0:h.find(e=>e.id===a);e&&(o(e),d(!0))}},[a,h]);let[R,T]=(0,n.useState)(!1),I=async e=>{var t,a,s,n;let l=await k.mutateAsync({ids:[e],triggerType:g.RssFetchTriggerType.Manual});(null===(t=l.successFeeds)||void 0===t?void 0:t.length)?r.iUO.success("抓取完成：".concat(null===(a=l.successFeeds[0])||void 0===a?void 0:a.newItemCount," 条新内容")):r.iUO.error("抓取失败：".concat(null===(n=l.failedFeeds)||void 0===n?void 0:null===(s=n[0])||void 0===s?void 0:s.error)),S()},A=async()=>{try{T(!0);let{successFeeds:e=[],failedFeeds:t=[]}=await k.mutateAsync({triggerType:g.RssFetchTriggerType.Manual}),{title:a,description:n}=D(h.length,e,t);r.Ew_.success({message:a,description:(0,s.jsx)("div",{className:"whitespace-pre",children:n})}),S()}finally{T(!1)}},C=e=>{r.aFV.confirm({title:"确认删除",icon:(0,s.jsx)(r.G2i,{}),content:"删除后无法恢复，是否继续？",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{var t;await f(e),r.iUO.success("删除成功"),null===(t=u.current)||void 0===t||t.reload()}})},M=a=>{if(0===e.length){r.iUO.warning("请选择要操作的项");return}let s=a?"启用":"禁用";r.aFV.confirm({title:"批量".concat(s),content:"确定要".concat(s,"选中的 ").concat(e.length," 项吗？"),onOk:async()=>{try{var n;await j(e.map(e=>({id:e,data:{enabled:a}}))),r.iUO.success("批量".concat(s,"成功")),t([]),null===(n=u.current)||void 0===n||n.reload()}catch(e){console.error("批量".concat(s,"失败:"),e),r.iUO.error("批量".concat(s,"失败，请稍后重试"))}}})},E=async e=>{try{var t;a?(await p(a,e),r.iUO.success("更新成功")):(await x(e),r.iUO.success("添加成功")),d(!1),l(void 0),o(null),null===(t=u.current)||void 0===t||t.reload()}catch(e){console.error("提交失败:",e),r.iUO.error("操作失败，请稍后重试")}},N=U({onAction:(e,t)=>{switch(e){case g.RssFeedActionType.Edit:l(t);break;case g.RssFeedActionType.Delete:C(t);break;case g.RssFeedActionType.Fetch:I(t)}},onEnabledChange:async(e,t)=>{var a;await p(t,{enabled:e}),r.iUO.success("".concat(e?"启用":"禁用","成功")),null===(a=u.current)||void 0===a||a.reload()},getItemCount:e=>{if(!w.data)return 0;let t=w.data.find(t=>t.feedId===e);return t?t.count:0}});return(0,s.jsxs)("div",{className:"rss-feed-table",children:[(0,s.jsxs)("div",{className:"flex justify-between mb-4",children:[(0,s.jsx)(r.$nd,{type:"primary",icon:(0,s.jsx)(r.bW0,{}),onClick:()=>{l(void 0),d(!0)},children:"添加订阅"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.$nd,{icon:(0,s.jsx)(r.OmY,{spin:R}),onClick:A,loading:R,children:"全部抓取"}),(0,s.jsx)(F,{selectedRowKeys:e,onBatchDelete:()=>{if(0===e.length){r.iUO.warning("请选择要删除的项");return}r.aFV.confirm({title:"批量删除",icon:(0,s.jsx)(r.G2i,{}),content:"确定要删除选中的 ".concat(e.length," 项吗？"),okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{var a;await v(e),r.iUO.success("批量删除成功"),t([]),null===(a=u.current)||void 0===a||a.reload()}})},onBatchEnable:()=>{M(!0)},onBatchDisable:()=>{M(!1)}})]})]}),(0,s.jsx)(r.iAN,{actionRef:u,rowKey:"id",columns:N,dataSource:h,loading:y,search:!1,options:!1,rowSelection:{selectedRowKeys:e,onChange:e=>{t(e.map(e=>String(e)))}},pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","50"],defaultPageSize:15}}),(0,s.jsx)(O,{visible:i,currentId:a,record:c,onCancel:()=>{d(!1),l(void 0),o(null)},onSubmit:E})]})},L=()=>[{title:"RSS源",dataIndex:["feed","name"],key:"feedName",width:300,render:(e,t)=>{var a;return(null===(a=t.feed)||void 0===a?void 0:a.name)?(0,s.jsx)(r.vwO,{children:t.feed.name}):(0,s.jsx)(r.vwO,{children:"未知"})}},{title:"执行时间",dataIndex:"executedAt",key:"executedAt",valueType:"dateTime"},{title:"状态",dataIndex:"status",key:"status",valueEnum:{success:{text:"成功",status:"Success"},error:{text:"失败",status:"Error"}}},{title:"触发方式",dataIndex:"triggerType",width:100,render:(e,t)=>(0,s.jsx)(r.vwO,{color:t.triggerType===g.RssFetchTriggerType.Manual?"blue":"green",children:t.triggerType===g.RssFetchTriggerType.Manual?"手动":"定时"})},{title:"新增内容",dataIndex:"itemCount",key:"itemCount"},{title:"错误信息",dataIndex:"errorMessage",key:"errorMessage",ellipsis:!0}],_=()=>{let{listState:e}=(0,j.EG)({list:{query:{where:{itemCount:{gt:0}},orderBy:{executedAt:"desc"},include:{feed:{select:{name:!0}}}}}});return(0,s.jsx)(r.iAN,{rowKey:"id",headerTitle:"抓取日志",search:!1,options:!1,dataSource:e.data,loading:e.isLoading,columns:L(),pagination:{showSizeChanger:!0,pageSizeOptions:["10","20","50"],defaultPageSize:10}})};function V(){let[e,t]=(0,n.useState)("feeds");return(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-3",children:"RSS信息抓取工具"}),(0,s.jsx)(r.tUM,{activeKey:e,onChange:e=>{t(e)},destroyInactiveTabPane:!0,items:[{key:"feeds",label:"RSS订阅管理",children:(0,s.jsx)(N,{})},{key:"items",label:"RSS内容列表",children:(0,s.jsx)(R,{})},{key:"logs",label:"抓取日志",children:(0,s.jsx)(_,{})}]})]})}},62253:(e,t,a)=>{Promise.resolve().then(a.bind(a,52816))},92211:(e,t,a)=>{"use strict";a.d(t,{ButtonsType:()=>l,CollectingType:()=>i,HabitFrequencyType:()=>s,HabitProgressStatus:()=>n,HabitStatusMode:()=>r,RssFeedActionType:()=>d.lQ,RssFetchTriggerType:()=>d.ln,RssFrequency:()=>d.b4,RssItemActionType:()=>d._1});var s=function(e){return e.DAILY="DAILY",e.WEEKLY="WEEKLY",e.MONTHLY="MONTHLY",e}({}),n=function(e){return e.Disabled="disabled",e.Enabled="enabled",e.Pending="pending",e.Doing="doing",e.Done="done",e.Failed="failed",e}({}),r=function(e){return e.Habit="habit",e.Record="record",e}({});a(93657);var l=function(e){return e.Command="command",e.Copy="copy",e}({}),i=function(e){return e.Url="url",e.Prompt="prompt",e.Copy="copywriter",e}({}),d=a(29392)},93657:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[6854,6410,541,6771,2602,1598,1815,8259,1210,2998,6502,5888,4030,794,9223,4033,9565,2983,3651,1026,959,5229,5533,667,587,8315,7358],()=>t(62253)),_N_E=e.O()}]);